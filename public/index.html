<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Putt Of The Day</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico"/>
  <style>
     html, body {
      height: 100%;
      margin: 0;
      display: flex;
      flex-direction: column;
      background:#0b0f12;color:#e7ecef;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif
    }

    #main-content {
      flex: 1; /* takes up remaining space */
      display: flex;
      justify-content: center; /* optional: center canvas horizontally */
      align-items: center;    /* optional: center canvas vertically */
    }

    #footer {
      text-align: center;
      padding: 10px;
      font-size: 0.9rem;
      color: #666;
    }

    #footer a {
      color: #007bff;
      text-decoration: none;
    }

    #footer a:hover {
      text-decoration: underline;
    }
    .wrap{display:flex;flex-direction:column;align-items:center;gap:.5rem;padding:1rem}
    canvas {
      background: #0a3a1a;
      border: 2px solid #0e2213;
      border-radius: 12px;
      touch-action: none;
      max-width: 100%;
      height: auto;
      display: block;
    }
    .hud{display:flex;gap:.75rem;align-items:center;flex-wrap:wrap;justify-content:center}
    .btn, input[type=text]{appearance:none;border:1px solid #2a2f33;background:#13181c;color:#e7ecef;border-radius:10px;padding:.5rem .75rem}
    .btn{cursor:pointer}
    .board{width:min(720px,95vw);background:#101316;border:1px solid #232a2f;border-radius:12px;padding:.5rem .75rem}
    table{width:100%;border-collapse:collapse;font-size:.95rem}
    th,td{padding:.35rem;border-bottom:1px dashed #1f252a;text-align:left}
    th{opacity:.8}
    .hint{opacity:.7;font-size:.9rem}
    .height32{height:32px}    
  </style>
</head>
  <body>
     <div id="main-content">
      <div class="wrap">
        <h1 style="margin:.25rem 0">Putt Of The Day</h1>
        <h2 style="margin:.25rem 0" id="levelname">Loading level...</h2>
        <h3 style="margin:.25rem 0;opacity:.7" id="level-by">By:</h3>
        <div class="hud">
          <span id="date"></span>
          <span>Strokes: <b id="strokes">0</b></span>
          <span>Time: <b id="time">0.0s</b></span>
          <input id="name" type="text" size="10" maxlength="12" placeholder="name"/>
          <button id="reset" class="btn">Reset</button>
          <input type="checkbox" id="mute" hidden />
          <label for="mute" id="mute-label" class="height32">
            <img id="mute-icon" width="32" height="32" style="background-color: white;border-radius: 8px;">
          </label>
          <label for="aim" id="aim-label" class="height32">
            <img id="aim-icon" width="32" height="32" style="background-color: white;border-radius: 8px;">
          </label>
        </div>
        <canvas id="g"></canvas>
        <div class="hint">Drag to aim, release to hit. r-click to switch aim angle. Same hole for everyone today.</div>

        <div class="board">
          <b>Today's Leaderboard</b>
          <div id="status" class="hint" style="margin:.25rem 0 .5rem"></div>
          <table>
            <thead><tr><th>#</th><th>Name</th><th>Strokes</th><th>Time</th></tr></thead>
            <tbody id="rows"></tbody>
          </table>
        </div>
      </div>
    </div>
    <footer id="footer">
      <a href="https://github.com/VilleKokkarinen/putt-of-the-day" target="_blank" rel="noopener noreferrer">
          View on GitHub
        </a>
    </footer>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script src="https://cdn.jsdelivr.net/npm/polygon-clipping@0.15.7/dist/polygon-clipping.umd.min.js"></script>
  <script type="module">
    import { TILE_SIZE, GRID_W, GRID_H } from './config.js';

    const logicalWidth = TILE_SIZE * GRID_W;
    const logicalHeight = TILE_SIZE * GRID_H;

    const canvas = document.getElementById('g');

    canvas.width = logicalWidth;
    canvas.height = logicalHeight;

    // Dynamically scale canvas to fit screen width
    function resizeCanvas() {
      const scale = Math.min(
        window.innerWidth / logicalWidth,
        window.innerHeight / logicalHeight,
        1 // never scale above original size
      );

      const width = logicalWidth * scale;
      const height = logicalHeight * scale;

      canvas.style.width = width + "px";
      canvas.style.height = height + "px";

      // Optionally center canvas horizontally
      canvas.style.display = "block";
      canvas.style.margin = "0 auto";
    }

    function scrollToCanvas() {
      const canvasRect = canvas.getBoundingClientRect();
      const scrollY = window.scrollY + canvasRect.top - (window.innerHeight - canvasRect.height) / 2;
      window.scrollTo({ top: scrollY, behavior: "smooth" });
    }

    function handleMobileOrientation() {
      window.setTimeout(() => {
        resizeCanvas();
        if (window.innerWidth > window.innerHeight) {
          // Landscape mode
          console.log("Landscape mode");
          scrollToCanvas();
        }
      }, 10);     
    }

    // Resize on load and when device rotates/resizes
    resizeCanvas();
    window.addEventListener("resize", resizeCanvas);
    window.addEventListener("orientationchange", handleMobileOrientation);
  </script>
  <script type="module" src="./main.js"></script>

  </body>
</html>